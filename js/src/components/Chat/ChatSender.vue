<template>
    <div>
                    <div class="ChatGroup-SenderContent" >
                        <div class="ChatGroup-SenderContent-line" v-if="reply.parent_comment_id === parentNode" >
                             <div class="icon">
                                <svg width="20" height="20" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 21a1 1 0 0 1-.883.993L19 22h-6.5a3.5 3.5 0 0 1-3.495-3.308L9 18.5V5.415L5.707 8.707a1 1 0 0 1-1.32.083l-.094-.083a1 1 0 0 1-.083-1.32l.083-.094 5-5a1.01 1.01 0 0 1 .112-.097l.11-.071.114-.054.105-.035.118-.025.058-.007L10 2l.075.003.126.017.111.03.111.044.098.052.092.064.094.083 5 5a1 1 0 0 1-1.32 1.497l-.094-.083L11 5.415V18.5a1.5 1.5 0 0 0 1.355 1.493L12.5 20H19a1 1 0 0 1 1 1Z" fill="#969696" />
                                </svg>
                            </div>
                        </div>
    
                        <div class="SenderContent-image">
                            <img src="../../../../image/profile.png" alt="">
                        </div>
                        <div class="SenderContent-about">
                            <div class="SenderContent-about-bio">
                                <!-- <span class="AboutBio-Person">{{ reply.user.first_name + " " +reply.user.last_name }}</span>
                                <span class="AboutBio-MessageDate">{{ datePipe(reply.created_at) }}</span> -->
                            </div>
                            <p>{{ reply.content }}</p>
                            <img v-if="reply.image" :src="reply.image" class="upload-image"/>
                            <div class="SenderContent-about-ShareLinks">
                                <span style="color: #377DD6;">
                                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M13.5112 5.65602C13.3145 5.41987 13.0683 5.22978 12.7901 5.09915C12.5119 4.96852 12.2084 4.90055 11.901 4.90002H8.70876L9.10079 3.89902C9.26386 3.46074 9.31816 2.98945 9.25905 2.52557C9.19994 2.06169 9.02917 1.61908 8.76139 1.23569C8.49362 0.852302 8.13683 0.539588 7.72163 0.324371C7.30643 0.109154 6.84522 -0.00214159 6.37755 3.12138e-05C6.24289 0.000312166 6.11116 0.0394238 5.99817 0.112677C5.88518 0.18593 5.79571 0.290215 5.7405 0.41303L3.74533 4.90002H2.10018C1.54318 4.90002 1.00899 5.12127 0.615129 5.51509C0.221269 5.90892 0 6.44306 0 7.00002V11.9C0 12.457 0.221269 12.9911 0.615129 13.3849C1.00899 13.7788 1.54318 14 2.10018 14H11.012C11.5033 13.9998 11.979 13.8274 12.3563 13.5128C12.7336 13.1982 12.9887 12.7612 13.0771 12.278L13.9662 7.37802C14.0212 7.07518 14.0089 6.76396 13.9303 6.46639C13.8517 6.16882 13.7086 5.89217 13.5112 5.65602ZM3.5003 12.6H2.10018C1.91452 12.6 1.73645 12.5263 1.60517 12.395C1.47388 12.2637 1.40012 12.0857 1.40012 11.9V7.00002C1.40012 6.81436 1.47388 6.63632 1.60517 6.50504C1.73645 6.37377 1.91452 6.30002 2.10018 6.30002H3.5003V12.6ZM12.6011 7.12602L11.712 12.026C11.6822 12.1891 11.5955 12.3363 11.4673 12.4414C11.3391 12.5465 11.1777 12.6027 11.012 12.6H4.90043V5.74702L6.80459 1.46303C7.0006 1.52017 7.18263 1.61731 7.3392 1.74834C7.49577 1.87936 7.62347 2.04141 7.71425 2.22427C7.80503 2.40713 7.85691 2.60682 7.86662 2.81074C7.87634 3.01465 7.84367 3.21837 7.77068 3.40902L7.39964 4.41002C7.32058 4.6216 7.29389 4.84916 7.32185 5.07329C7.34981 5.29742 7.43158 5.51146 7.56019 5.69714C7.6888 5.88282 7.86043 6.03462 8.06044 6.1396C8.26044 6.24459 8.48287 6.29962 8.70876 6.30002H11.901C12.0039 6.29985 12.1055 6.32234 12.1987 6.3659C12.2918 6.40945 12.3743 6.473 12.4401 6.55202C12.5075 6.62994 12.5569 6.7218 12.5848 6.82102C12.6126 6.92024 12.6182 7.02439 12.6011 7.12602Z"
                                            fill="#377DD6" />
                                    </svg>
                                    Liked
                                </span>
    
                                <span @click="sendReplyId()"> 
                                    <svg width="14" height="9" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M11.3742 2.45698H2.98032L4.11817 1.40192C4.28299 1.24791 4.37558 1.03903 4.37558 0.821224C4.37558 0.603422 4.28299 0.39454 4.11817 0.240531C3.95335 0.0865216 3.72981 1.62275e-09 3.49673 0C3.26364 -1.62275e-09 3.0401 0.0865216 2.87528 0.240531L0.249465 2.69416C0.169779 2.77195 0.107315 2.86367 0.0656573 2.96406C-0.0218858 3.16318 -0.0218858 3.38653 0.0656573 3.58565C0.107315 3.68605 0.169779 3.77777 0.249465 3.85555L2.87528 6.30918C2.95665 6.38584 3.05346 6.44669 3.16012 6.48821C3.26678 6.52973 3.38118 6.55111 3.49673 6.55111C3.61227 6.55111 3.72668 6.52973 3.83334 6.48821C3.94 6.44669 4.0368 6.38584 4.11817 6.30918C4.20021 6.23315 4.26532 6.14269 4.30976 6.04303C4.3542 5.94336 4.37707 5.83646 4.37707 5.72849C4.37707 5.62052 4.3542 5.51362 4.30976 5.41395C4.26532 5.31429 4.20021 5.22383 4.11817 5.1478L2.98032 4.09273H11.3742C11.6063 4.09273 11.8289 4.1789 11.9931 4.33229C12.1572 4.48567 12.2495 4.6937 12.2495 4.91061V8.18212C12.2495 8.39904 12.3417 8.60707 12.5058 8.76045C12.67 8.91383 12.8926 9 13.1247 9C13.3569 9 13.5795 8.91383 13.7436 8.76045C13.9078 8.60707 14 8.39904 14 8.18212V4.91061C14 4.25987 13.7234 3.63578 13.2309 3.17563C12.7385 2.71549 12.0706 2.45698 11.3742 2.45698Z"
                                            fill="#B8B8B8" />
                                    </svg>
                                    Reply
    
                                </span>
    
                                <span>
                                    <input type="file" :id="reply.id" accept="image/png, image/gif, image/jpeg"  class="hidden"  @change="fileInput($event)" />
                                        <label :for="reply.id">
                                        <svg width="10" height="16" viewBox="0 0 10 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M7.59293 4.99234L7.65329 11.164C7.61516 11.927 7.28662 12.6407 6.73489 13.1592C6.18315 13.6777 5.44992 13.9619 4.68516 13.9535C3.92041 13.9451 3.18193 13.6448 2.62078 13.1141C2.05963 12.5833 1.71822 11.8623 1.66639 11.0983L1.59477 3.11562C1.60254 2.6511 1.78848 2.21085 2.11419 1.88579C2.43991 1.56073 2.88052 1.37567 3.34506 1.36883C3.81254 1.37708 4.26163 1.56906 4.59514 1.90324C4.92865 2.23742 5.11974 2.68689 5.12705 3.15439L5.18378 10.0344C5.18704 10.1052 5.17633 10.1757 5.15227 10.2418C5.1282 10.3079 5.09126 10.3683 5.04355 10.4197C4.99583 10.4711 4.93828 10.5123 4.87417 10.5411C4.81007 10.5699 4.74067 10.5857 4.66993 10.5875C4.59919 10.5894 4.52851 10.5772 4.46191 10.5519C4.39532 10.5265 4.33411 10.4883 4.28179 10.4396C4.22947 10.3908 4.18706 10.3324 4.15699 10.2677C4.12691 10.203 4.10975 10.1333 4.1065 10.0625L4.06561 4.94865C4.06392 4.76075 3.98766 4.57973 3.85361 4.44541C3.71956 4.31109 3.53869 4.23447 3.3508 4.23241C3.16291 4.23035 2.98338 4.30301 2.85171 4.43441C2.72004 4.56582 2.64702 4.7452 2.64871 4.9331L2.69966 10.057C2.70096 10.3122 2.75275 10.5655 2.85205 10.8025C2.95134 11.0395 3.09618 11.2554 3.27822 11.4378C3.46025 11.6202 3.67587 11.7655 3.91266 11.8653C4.14944 11.965 4.4027 12.0173 4.65783 12.0191C5.16853 12.0123 5.65312 11.8092 6.01118 11.4519C6.36925 11.0945 6.57334 10.6103 6.58117 10.0996L6.51446 3.2195C6.47806 2.397 6.12406 1.61437 5.52704 1.03649C4.93002 0.458618 4.1366 0.130614 3.31392 0.121586C2.49124 0.112559 1.70354 0.423212 1.11678 0.988096C0.53001 1.55298 0.189987 2.32799 0.168342 3.14986L0.239959 11.1326C0.308027 12.2675 0.810955 13.3412 1.64396 14.1299C2.47696 14.9186 3.57579 15.3615 4.71151 15.3662C5.84722 15.3709 6.93224 14.9372 7.74048 14.1554C8.54872 13.3736 9.01786 12.3039 9.05015 11.1694L8.99977 4.9978C8.99893 4.90476 8.97978 4.81244 8.94341 4.72609C8.90703 4.63975 8.85415 4.56107 8.78777 4.49456C8.7214 4.42806 8.64283 4.37501 8.55656 4.33847C8.47028 4.30192 8.378 4.28258 8.28496 4.28156C8.19193 4.28054 8.09997 4.29786 8.01433 4.33252C7.9287 4.36718 7.85107 4.4185 7.78587 4.48357C7.72068 4.54863 7.66919 4.62616 7.63436 4.71173C7.59953 4.79729 7.58203 4.88922 7.58287 4.98225L7.59293 4.99234Z"
                                                fill="#B8B8B8" />
                                        </svg>
                                        Add Image
                                        </label>
                                </span>
                            </div>
                        </div>
                
                    </div>
                    <div v-if="showPostMessage" class="ChatGroup-SenderMessage" >
                    <PostMessage @onEnter="sendDiscussion" />
                    </div>
                    </div>
    </template>
    <script>
    import moment from 'moment'
    import PostMessage from './PostMessage.vue'
    
    export default {
        components: {
        PostMessage,
    },
        props: {
            
            /**
             * The reply  
             * @values {}
             */
            reply: {
                type: Object
            },
    
            /**
             * parentNode Id
             * @values 1,2,3 .....
             */
            parentNode: {
                type:Number
            },
    },
        data: () => ({
            showPostMessage: false,
        }),
        
        methods: {
            /**
             * This function takes date:String and converts it to appropriate format 
             * e.g.  5d , 17 hrs ago etc ...
             */
            datePipe(created_at) {
                const date = new Date(created_at)
                return moment(date).fromNow()
            },
    
            /**
             * This function emits reply id to the parent component
             * @event replyId
             * @type {number} 
             */
            sendReplyId() {
                //toggle post message component
                this.showPostMessage = !this.showPostMessage
                if (this.showPostMessage)
                // emit reply id if the post message component is toggled on
                    this.$emit('replyId', this.reply.id)
                else
                    this.$emit('replyId',null)
    
            },
    
            /**
             * This function handles the data emitted and 
             * emits the same data to the parent component
             * 
             * It also toggles off the post message components 
             * 
             * @event sendReply
             * @type {String} 
             * 
             */
            sendDiscussion(message) { 
                //toggle off the post message component
                this.showPostMessage = false
    
                // emitting data
                this.$emit('sendReply',message)
            },
    
            fileInput(e) {
               
                let base64Image = undefined
                let payload = {
                    comment_id:this.reply.id,
                    type:'IMAGE',
                }
                
                if (e.target.files.length > 0) {
                
                    const  uploadedImage = e.target.files['0']
                    const reader = new FileReader();
                    reader.onload = () => {
                    base64Image = reader.result;
                    payload.image_data = base64Image
    
                        this.$emit('uploadImage', payload)
                        
          };
          reader.readAsDataURL(uploadedImage);
                }
            }
        }
    }
    </script>
    <style scoped>
    ::file-selector-button,
    .hidden {
        display: none;
    }
    </style>